我们提出的核心架构是**“主控Agent + 多功能子Agent”**模式。

主控Agent (Master Agent)，它扮演着项目经理或团队大脑的角色。它不直接执行具体任务，而是负责理解用户的最终意图，将一个模糊的、高层次的策略想法（例如“寻找近期有高管增持的低估值小盘股策略”）拆解成一系列清晰、可执行的子任务。然后，它将这些任务精准地分发给对应的功能子Agent，并负责协调它们之间的工作流，处理异常，最终将结果汇总呈现给用户。

功能子Agent (Functional Sub-Agents)，它们是各自领域的专家。每个子Agent都专注于一项特定任务，比如数据采集、因子挖掘、策略回测等。它们接收主控Agent的指令，高效完成自己的工作，并将结果返回。

模型首选在中文语料上经过充分训练，并且最好在金融领域进行过微调的模型。国内的一些模型在这方面表现出色，例如幻方量化自研的DeepSeek

在我们的量化Agent系统中，RAG的应用场景非常广泛。

实时新闻分析。当用户询问“最近有哪些关于半导体行业的利好政策？”时，系统会先从实时新闻数据库中检索相关政策文件和解读文章，再交由LLM进行总结和分析。

合规性检查。将最新的交易法规和风控规则存入知识库。在生成交易指令前，Agent可以通过RAG查询，确保指令符合所有合规要求。

开源数据源（启动阶段）。在策略研发和初步回测阶段，开源数据是性价比最高的选择。它们足以满足大部分基础需求。

Tushare。提供非常全面的A股数据，包括行情、财务、宏观经济等。其积分制在免费和付费之间提供了平滑的过渡。

舆情数据。通过爬取主流财经媒体、社交平台（如雪球、东方财富股吧）的文本数据，利用NLP技术进行情感分析、主题建模，可以构建高频的投资者情绪因子

结构化数据存储。对于行情、财务报表这类结构化数据，时间序列数据库（Time-Series Database）是最佳选择。例如InfluxDB或DolphinDB，它们针对时间戳索引进行了深度优化，查询速度极快，非常适合存储和分析大量的K线数据。对于非时间序列的结构化数据，如公司基本信息，传统的关系型数据库如MySQL或PostgreSQL依然是可靠的选择。

非结构化数据存储。新闻、公告、研报等文本数据，其结构不固定，适合使用文档数据库（Document Database），如MongoDB。它可以灵活地存储JSON格式的文档，便于后续进行信息抽取和自然语言处理。


主控Agent 
这是整个系统的“大脑”和“指挥官”，负责解析、规划、协调和监督。它本身不执行具体的量化任务，但它的智能化程度决定了整个系统自动化的上限。

核心职责
自然语言理解（NLU）。精准理解用户以自然语言输入的、可能模糊的策略意图。

任务规划与拆解（Planning & Decomposition）。将宏大的目标分解为一系列逻辑清晰、前后依赖的子任务，并为每个子任务选择最合适的执行Agent。

工作流编排（Orchestration）。管理子任务的执行顺序确保整个流程顺畅进行。

状态监控与异常处理（Monitoring & Exception Handling）。实时跟踪每个子任务的状态，当出现失败、超时或预期外的结果时，启动容错机制（如重试、切换备用方案）或向用户报警。

结果汇总与报告生成（Aggregation & Reporting）。将各个子Agent返回的结果进行整合，形成一份逻辑连贯、易于理解的最终报告呈现给用户。

数据采集与清洗Agent
获取提取的序列化数据或者舆情数据，选择对应的地方保存

策略开发与回测Agent
策略代码生成。根据用户的自然语言描述或指定的因子组合，自动生成符合特定回测框架的代码。
回测参数配置。设置回测的起止时间、基准、交易成本（手续费、印花税）、滑点等，确保模拟环境的真实性。

执行回测。调用回测引擎，在历史数据上“运行”策略。

绩效评估与报告。生成包含年化收益率、夏普比率、最大回撤、胜率、盈亏比等关键指标的详细回测报告，并进行可视化展示。

这个工作流可以分解为以下几个关键阶段。

需求定义与任务启动。一切始于用户的自然语言输入。用户不需要编写任何代码，只需像与真人投研经理对话一样，描述自己的策略构想。主控Agent会利用LLM的理解能力，将这个模糊的想法转化为一个结构化的任务计划。

数据准备与特征构建。主控Agent向数据Agent发出指令。数据Agent自动数据源拉取所需数据，并执行前文所述的完整清洗和特征工程流程。
策略Agent将生成的因子组合成具体的交易逻辑，并自动编写成符合特定回测框架的代码回测完成后，一份包含年化收益、最大回撤、夏普比率等关键指标的报告会呈现给用户。

主控Agent可以解读这份报告，并提出优化建议，例如“策略在某某年份表现不佳，可能是因为缺少对某某行业的风险敞口控制，是否需要加入行业中性化的约束？” 从而开启新一轮的迭代。

规避回测陷阱
：确保在模拟的任何一个时间点，策略决策只使用了该时间点之前的信息。Agent在生成代码时，会自动检查是否存在数据引用的错误。


