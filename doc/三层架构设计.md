# Multi-Agent Quant Trader 三层架构设计

## 架构概述

本系统采用分层解耦的三层架构设计：

### 1. Web表示层 (Flask Web Layer)
- **功能定位**: 用户与AI Agent的交互界面 + 回测结果展示
- **主要职责**:
  - 提供聊天界面，用户可以与多智能体进行对话
  - 展示Agent的分析过程和决策链路
  - 回测结果的可视化展示（图表、报表）
  - 策略配置和参数设置界面

### 2. 应用服务层 (Python Service Layer)  
- **功能定位**: 多智能体业务逻辑 + 数据处理服务
- **主要职责**:
  - LangGraph多智能体协作决策
  - RAG增强检索和新闻情报分析
  - 策略生成和信号处理
  - 与C++引擎的数据交换

### 3. 计算引擎层 (C++ Computing Layer)
- **功能定位**: 高性能回测计算引擎
- **主要职责**:
  - 历史数据的快速回放和撮合
  - 订单簿维护和交易执行模拟
  - 性能指标计算和风险评估

## 推荐目录结构

```
Multi-Agent-Quant-Trader/
├── config/                          # 全局配置
│   ├── api_config.json             # API密钥配置
│   ├── web_config.yaml             # Web服务配置
│   └── engine_config.yaml          # 引擎参数配置
├── storage/                         # 数据存储
│   ├── market_data/                # 历史行情数据
│   ├── news_embeddings/            # 新闻向量数据库
│   └── results/                    # 回测结果存储
├── src/
│   ├── web_layer/                  # Web表示层 (Flask)
│   │   ├── app.py                  # Flask应用入口
│   │   ├── routes/                 # 路由定义
│   │   │   ├── __init__.py
│   │   │   ├── chat_routes.py      # Agent对话接口
│   │   │   ├── backtest_routes.py  # 回测相关接口
│   │   │   └── dashboard_routes.py # 仪表板接口
│   │   ├── templates/              # HTML模板
│   │   │   ├── base.html
│   │   │   ├── chat.html           # Agent对话页面
│   │   │   ├── dashboard.html      # 回测结果展示
│   │   │   └── config.html         # 策略配置页面
│   │   ├── static/                 # 静态资源
│   │   │   ├── css/
│   │   │   ├── js/
│   │   │   └── images/
│   │   └── utils/                  # Web工具函数
│   │       ├── auth.py             # 用户认证
│   │       └── websocket.py        # WebSocket处理
│   ├── service_layer/              # 应用服务层 (Python)
│   │   ├── agents/                 # 多智能体模块
│   │   │   ├── __init__.py
│   │   │   ├── base_agent.py       # Agent基类
│   │   │   ├── data_analyst.py     # 数据分析师Agent
│   │   │   ├── risk_manager.py     # 风控官Agent
│   │   │   ├── portfolio_manager.py # 基金经理Agent
│   │   │   └── coordinator.py      # 协调器Agent
│   │   ├── rag/                    # RAG检索模块
│   │   │   ├── __init__.py
│   │   │   ├── news_retriever.py   # 新闻检索器
│   │   │   ├── embedding_manager.py # 向量管理
│   │   │   └── temporal_filter.py  # 时序过滤器
│   │   ├── strategy/               # 策略管理
│   │   │   ├── __init__.py
│   │   │   ├── strategy_builder.py # 策略构建器
│   │   │   └── signal_processor.py # 信号处理器
│   │   ├── data/                   # 数据服务
│   │   │   ├── __init__.py
│   │   │   ├── market_data_service.py # 行情数据服务
│   │   │   └── news_data_service.py   # 新闻数据服务
│   │   └── main.py                 # 服务层入口
│   └── cpp_engine/                 # 计算引擎层 (C++)
│       ├── include/                # 头文件
│       │   ├── Engine.h            # 主引擎接口
│       ├── src/                    # 实现文件
│       │   ├── Engine.cpp
│       ├── bindings/               # Python绑定
│       │   ├── pybind_engine.cpp   # Pybind11绑定
│       │   └── python_interface.h  # Python接口定义
│       └── tests/                  # C++单元测试
├── tests/                          # 集成测试
│   ├── web_tests/                  # Web层测试
│   ├── service_tests/              # 服务层测试
│   └── integration_tests/          # 集成测试
├── docs/                           # 文档
│   ├── architecture.md             # 架构文档
│   ├── api_docs.md                # API文档
│   └── deployment.md              # 部署文档
├── scripts/                        # 部署脚本
│   ├── build_cpp.sh               # C++构建脚本
│   ├── start_web.sh               # Web服务启动
│   └── deploy.sh                  # 部署脚本
├── CMakeLists.txt                  # C++构建配置
└── requirements.txt                # Python依赖
```

## 数据流向

1. **用户交互**: Web Layer ← → Service Layer (Agent对话)
2. **策略执行**: Service Layer → C++ Engine (回测计算)  
3. **结果展示**: C++ Engine → Service Layer → Web Layer (结果可视化)

## 技术栈分配

- **Web Layer**: Flask + WebSocket + Chart.js/D3.js
- **Service Layer**: LangGraph + ChromaDB + FastAPI
- **Engine Layer**: C++17 + Pybind11 + OpenMP
